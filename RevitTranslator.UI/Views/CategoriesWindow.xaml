<ui:FluentWindow
    x:Class="RevitTranslator.UI.Views.CategoriesWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:contracts="clr-namespace:RevitTranslator.UI.Contracts"
    xmlns:converters="clr-namespace:RevitTranslator.UI.Views.Converters"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance contracts:ICategoriesWindowViewModel}"
    ExtendsContentIntoTitleBar="True"
    Title="Translate Categories Window"
    Height="600"
    MinHeight="300"
    Width="500">

    <b:Interaction.Triggers>
        <b:EventTrigger EventName="Loaded">
            <b:InvokeCommandAction Command="{Binding LoadedCommand}" />
        </b:EventTrigger>
    </b:Interaction.Triggers>

    <ui:FluentWindow.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ui:WpfUiDictionary />
                <ResourceDictionary Source="../Resources/ResourceDictionaries/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </ui:FluentWindow.Resources>

    <Grid>
        <DockPanel>
            <ui:TitleBar
                DockPanel.Dock="Top"
                Title="Revit Translator | Select Categories"
                Height="32"
                ShowMinimize="False"
                ShowMaximize="False"
                CloseClicked="OnCloseClicked" />
            <Button
                DockPanel.Dock="Bottom"
                Content="{Binding MainButtonText}"
                Command="{Binding TranslateCommand}"
                Click="OnTranslateButtonClicked"
                Style="{StaticResource LargeRectangularButton}" />
            <Grid
                DockPanel.Dock="Top">
                <ScrollViewer
                    Margin="14 36 0 0"
                    VerticalScrollBarVisibility="Auto"
                    HorizontalScrollBarVisibility="Disabled">
                    <ItemsControl
                        x:Name="CategoryTypeCards"
                        DockPanel.Dock="Top"
                        Margin="0 8 14 14"
                        ItemsSource="{Binding CategoryTypes}">
                        <ItemsControl.Resources>
                            <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}"
                                             Color="Transparent" />
                        </ItemsControl.Resources>
                        <ItemsControl.ItemContainerStyle>
                            <Style
                                TargetType="{x:Type ContentPresenter}">
                                <Setter
                                    Property="Visibility"
                                    Value="{Binding IsVisible,
                                        Converter={converters:CollapsedBoolVisibilityConverter},
                                        Mode=OneWay}" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <ui:CardExpander
                                    Padding="4 8 16 8"
                                    Margin="0 4"
                                    IsExpanded="{Binding IsExpanded,
                                        Mode=TwoWay,
                                        UpdateSourceTrigger=PropertyChanged}">
                                    <ui:CardExpander.Header>
                                        <CheckBox
                                            IsChecked="{Binding IsChecked}"
                                            Content="{Binding Name, Mode=OneWay}"
                                            VerticalContentAlignment="Center" />
                                    </ui:CardExpander.Header>
                                    <ui:CardExpander.Content>
                                        <ItemsControl
                                            ItemsSource="{Binding Categories}">
                                            <ItemsControl.ItemContainerStyle>
                                                <Style
                                                    TargetType="{x:Type ContentPresenter}">
                                                    <Setter
                                                        Property="Visibility"
                                                        Value="{Binding IsVisible,
                                                            Converter={converters:CollapsedBoolVisibilityConverter},
                                                            Mode=OneWay}" />
                                                </Style>
                                            </ItemsControl.ItemContainerStyle>
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <Border
                                                        x:Name="ItemBorder"
                                                        Background="Transparent"
                                                        BorderThickness="1"
                                                        BorderBrush="Transparent"
                                                        CornerRadius="4"
                                                        Padding="0 4"
                                                        Cursor="Hand"
                                                        MouseLeftButtonUp="OnItemBorderLeftMouseUp">
                                                        <CheckBox
                                                            x:Name="CategoryCheckBox"
                                                            IsChecked="{Binding IsChecked, 
                                                                Mode=TwoWay, 
                                                                UpdateSourceTrigger=PropertyChanged}"
                                                            Content="{Binding Name, 
                                                                Mode=OneTime}"
                                                            VerticalContentAlignment="Center" />
                                                    </Border>
                                                    <DataTemplate.Triggers>
                                                        <Trigger
                                                            SourceName="ItemBorder"
                                                            Property="IsMouseOver"
                                                            Value="True">
                                                            <Setter
                                                                TargetName="ItemBorder"
                                                                Property="Background"
                                                                Value="{DynamicResource ControlFillColorSecondaryBrush}" />
                                                            <Setter
                                                                TargetName="ItemBorder"
                                                                Property="BorderBrush"
                                                                Value="{DynamicResource ControlElevationBorderBrush}" />
                                                        </Trigger>
                                                    </DataTemplate.Triggers>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </ui:CardExpander.Content>
                                </ui:CardExpander>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
                <ui:TextBox
                    Icon="{ui:SymbolIcon Search24}"
                    Background="White"
                    ShowClearButton="True"
                    Height="36"
                    VerticalAlignment="Top"
                    IsEnabled="{Binding IsLoading,
                        Converter={converters:InverseBoolConverter},
                        UpdateSourceTrigger=PropertyChanged}"
                    Text="{Binding SearchText, 
                        Mode=TwoWay, 
                            UpdateSourceTrigger=PropertyChanged}"
                    PlaceholderText="Search category name..."
                    Margin="14 4 14 0">
                    <ui:TextBox.Effect>
                        <DropShadowEffect
                            Direction="270"
                            Opacity="0.1"
                            BlurRadius="12"
                            RenderingBias="Performance"
                            ShadowDepth="8" />
                    </ui:TextBox.Effect>
                </ui:TextBox>
            </Grid>
        </DockPanel>
    </Grid>
</ui:FluentWindow>